---
layout: post
title: Raphaël 在 IE8 下性能差的解决方案 
categories: js
own: 转载
---
Raphaël 具有良好的兼容——IE能兼容到ie6，非常适合国情，但是情况正在发生变化，尤其是 在国外，考虑到IE9以及其他浏览器的份额，Raphaël 的作者推出了一个叫 Snap.svg 的 图形库，跟Raphaël 不同，Snap.svg完全是基于svg的图行库，少了些束手束脚。

不过在国内，ie6/7/8/仍然不可忽视，因此Raphaël 仍然是比较好的选择。

微软从IE9开始支持svg矢量图形技术，Raphaël 在 ie6/7/8 上使用的是专有的vml技术来模 拟svg的特性。

### vml在IE8浏览器下性能非常之差

我们知道，直到IE9才支持svg，微软必须跟上开放标准的潮流，vml的没落就像很多IE其它专 有特性一样，渐渐被抛弃，到IE8最终发布的时候，对vml的支持已经非常不好了。
并且，相比IE6/7，IE8下vml性能问题差了很多，可以看[stackoverflow上的一个用户测试](http://jsfiddle.net/t5NGF/)

<iframe width="100%" height="300" src="http://jsfiddle.net/cuc_ygh/79hfprba/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Raphael IE8 性能差的应对方案

1、通过修改meta标签，让IE8运行在IE7模式下，如下：

<iframe width="100%" height="70" src="http://jsfiddle.net/cuc_ygh/z46uf748/embedded/html/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

但是，如果仅仅是这样的化会误伤IE9 —— IE9 已经支持svg了，如果页面上还有这个声明的 化，那么IE9也会以IE7模式来渲染页面。抛弃svg而使用vml，这样显然是很不合理的。

我困惑了很久，想尝试使用IE的另一个奇葩特性——条件注释来避免这个问题：

2、将meta标签放在条件注释中，如下：

<iframe width="100%" height="240" src="http://jsfiddle.net/cuc_ygh/fzpLunvk/embedded/html/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

但是遗憾的是，浏览器根本就不识别这样注释后的meta标签，所以这种方案以失败告终。

### 最终解决方案

<iframe width="100%" height="70" src="http://jsfiddle.net/cuc_ygh/0qz2khyy/embedded/html/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### 其他问题

IE确实支持这样的写法，不过还是有坑的，在iframe下有问题，详细参看stackoverflow上的 讨论 [3]

1、[http://www.cnblogs.com/rubylouvre/archive/2009/10/12/1581891.html](http://www.cnblogs.com/rubylouvre/archive/2009/10/12/1581891.html)

2、[http://stackoverflow.com/questions/6156639/x-ua-compatible-is-set-to-ie-edge-but-it-still-doesnt-stop-compatibility-mode](http://stackoverflow.com/questions/6156639/x-ua-compatible-is-set-to-ie-edge-but-it-still-doesnt-stop-compatibility-mode)

3、[http://stackoverflow.com/questions/3413629/emulate-ie7-for-ie8-but-not-for-ie9-using-x-ua-compatible](http://stackoverflow.com/questions/3413629/emulate-ie7-for-ie8-but-not-for-ie9-using-x-ua-compatible)