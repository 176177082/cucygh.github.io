---
layout: post
title: UI复杂交互的MVVM模型
categories: flex
own: 原创
---

### 写在前面

本节采用倒序方式讲解，有利于理解当初我的思路。

### 效果图

我们要做成这个样子滴。

![一场制胜](/assets/img/blog/flex/dgp.gif)

### 知识课堂

该产品叫竞猜足球一场制胜。我们是在500万、爱彩网、澳客网等之后推出的产品，至于为什么要做这款产品呢？做这个之前讲几个术语：

1、单关
	
通俗来说就用户随便选一个赛果即可投注，比如世界杯期间，用户就投一场“阿根廷 胜”；

2、过关

与单关对比，就是用户选择一场“阿根廷 胜”还需要额外选择最少一场比赛来组成N串m来投注，只有当所选比赛全部猜中才能中奖。

3、一场制胜

其实就是将“过关”当作“单关”玩。为什么这么玩？因为单关的赔率低，过关不好中。这个具体怎么玩？举例说明：
比赛：巴西 VS 智利  哥伦比亚VS乌拉圭
用户投注 “巴西 胜”即可投注，系统自动为之匹配 “巴西胜” and “哥伦比亚 胜”   “巴西胜” and “哥伦比亚 让负”   

### 问题分析

针对要显示的结果我们分析如何设计页面交互，先看下某一场的单个场次内部的数据关系。

![明细](/assets/img/blog/flex/dgp-detail.png)

1、投注场次时间

2、投注开赛时间

3、投注对阵

4、投注赛果和相关赔率

5、配对场次时间

6、配对场次对阵和相关赔率

7、某个场次所有投注的奖金范围

8、注场次某个赛果和配对场次的组合及赔率乘积（这是一个集合）

9、赔率乘积，在第8个出现过，且与计算所得倍数密切相关。

10、倍数，这个产品最核心的数值就是它，奖金范围和它有关。

11、每个组合的奖金，和奖金范围有关。

到目前为止看下我们需要的数据及他们之间的关联。

孤立的数据：1、2、3、5，他们是静态数据，不参与计算。

关联的数据：4、6、7、8、9、10、11，他们是动态数据，要参与计算；再进一步分析这些数据之间是如何关联的。

4和6计算出8和9，9和10有关（后续讲述），9和10再次计算得出11，11和7有关（后续讲述）。

再看下场次和场次之间的数据关系以及单场次和汇总数据的关系。

![汇总](/assets/img/blog/flex/dgp-detail2.png)

12、投注总倍数

13、总金额

14、最高奖金

15、奖金分布

这里都是关联数据，关系如下：

12、11得15、15得出14，10和12得出13。

是不是有点乱？

### 难点阐释

看完上述数据关系，我们看下难点在哪？还得回顾下第二个图，如下：

![明细](/assets/img/blog/flex/dgp-detail.png)

<b>上文</b> 4和6计算出8和9，9和10有关（后续讲述）：

1、8是由4和6决定的一个集合，这个集合怎么算？

这个集合不同于单纯的数学组合运算，这个是文本组合同时里面包含数据计算，还要考虑主让球还是客让球。

2、算出来怎么显示？如果显示格式灵活变化怎么处理？

<b>上文</b> 9和10再次计算得出11，11和7有关（后续讲述）：

1、这个地方隐藏了一个关系就是10是怎么计算出来的？

举个例子：

巴西赔率    3.5

西班牙赔率  4.2

德国赔率	1.7

荷兰赔率	2.3

假设4个队同时开赛，我买40倍，现在要把40倍分给不同的球队保证不管他们哪个中，我都能盈利趋于平均,当然任何球队分得的倍数不能小于1。这个过程就是计算10的过程。

2、11和7之间是正比例关系吗？当然这个地方也隐藏了一层关系，即：比赛互斥关系，上图：

![互斥](/assets/img/blog/flex/dgp-detail-huchi.png)

从这个图可以简单的看出奖金范围不是单纯的最小值和最大值，也不是简单的累加，因为赛果是固定的，子项组合要看是否互斥，比如选择了“胜”的选项，筛选组合就不能包含“平”“负”的子项。


### 数据处理

上面说了很多，接下来上数据吧，看看数据的转换过程。以如下投注为例：

![投注](/assets/img/blog/flex/dgp-bet.png)

服务器的比赛信息

<iframe width="100%" height="300" src="http://jsfiddle.net/cuc_ygh/wkxgrqjm/2/embedded/js/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

客户端处理后的数据模型

![结果](/assets/img/blog/flex/dgp-result.png)


### 模板

<iframe width="100%" height="300" src="http://jsfiddle.net/cuc_ygh/wkxgrqjm/1/embedded/html/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>


### 结束

说了很多，不知道是否好理解，有什么建议直接反馈吧
